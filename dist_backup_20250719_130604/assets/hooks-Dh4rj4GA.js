import{r as i,u as F,b as G}from"./react-vendor-4KVcW9E9.js";import{o as M,k as I,j as N,f as P,q as _,h as L,w as D,r as J,t as S,u as O,z as R,A as K,B as Y,s as Z,C as X,D as V,E as ee,m as te,F as z,l as oe}from"./firebase-vendor-DqmTlSD9.js";import{d as E,a as U,p as ae}from"./admin-pages-NPVKbNvB.js";import{v as re,s as ie,g as $,a as ne,d as se,i as ce,b as le}from"./components-DnyS3Eh5.js";let W=null;async function de(){var e,r,n;if(W!==null)return W;try{const u=L(E,"gamification_rewards"),h=(await P(_(u,D("type","==","acesso_vip")))).docs.find(d=>d.data().title.toLowerCase().includes("referral")),s=((n=(r=(e=h==null?void 0:h.data())==null?void 0:e.metadata)==null?void 0:r.discount)==null?void 0:n.percentage)||50;return W=s,s}catch{return console.warn("⚠️ Falha ao buscar recompensa de referral. Usando fallback padrão."),50}}function H(){const[e,r]=i.useState(null),[n,u]=i.useState(!0),[f,h]=i.useState(!1),s=F();i.useEffect(()=>{if(f)return;let o=!0;h(!0);const b=setTimeout(()=>{o&&n&&(console.warn("⚠️ Timeout de segurança - finalizando loading"),u(!1))},1e4),w=M(U,async A=>{if(o){if(A)try{const t=I(E,"users",A.uid);if(!(await N(t)).exists()){let l=null;const p=localStorage.getItem("referralCode");if(p){const y=await P(_(L(E,"users"),D("gamification.referralCode","==",p)));y.empty||(l=y.docs[0].id)}const k=await de();await J(t,{uid:A.uid,displayName:A.displayName||"",email:A.email||"",photoURL:A.photoURL||"",telefone:null,whatsapp:null,box:"",categoria:"publico",cidade:"",mensagem:"",role:"publico",isActive:!0,profileComplete:!1,createdAt:S(),updatedAt:S(),gamification:{tokens:{box:{balance:l?k:0,totalEarned:l?k:0,totalSpent:0,lastTransaction:S()}},level:"iniciante",totalActions:0,lastActionAt:S(),achievements:[],rewards:[],streakDays:0,lastLoginStreak:S(),referralCode:`REF${A.uid.slice(-6).toUpperCase()}`,referrals:[],referralTokens:0,weeklyTokens:0,monthlyTokens:0,yearlyTokens:0,bestStreak:0,badges:[],challenges:[],...l?{referredBy:l}:{}}}),l&&(await O(I(E,"users",l),{"gamification.referrals":K(A.uid),"gamification.referralTokens":R(k),"gamification.tokens.box.balance":R(k),"gamification.tokens.box.totalEarned":R(k),"gamification.totalActions":R(1),"gamification.lastActionAt":S(),updatedAt:S()}),localStorage.removeItem("referralCode"))}const a=(await N(t)).data(),m={...A,role:(a==null?void 0:a.role)||"publico",telefone:(a==null?void 0:a.telefone)||null,whatsapp:(a==null?void 0:a.whatsapp)||null,box:(a==null?void 0:a.box)||"",categoria:(a==null?void 0:a.categoria)||"publico",cidade:(a==null?void 0:a.cidade)||"",mensagem:(a==null?void 0:a.mensagem)||"",isActive:(a==null?void 0:a.isActive)??!0,profileComplete:(a==null?void 0:a.profileComplete)||!1,adminVerification:a==null?void 0:a.adminVerification};r(m),s("/home")}catch(t){console.error("❌ Erro ao carregar dados do usuário:",t),r({...A,role:"publico",profileComplete:!1})}else r(null);u(!1),clearTimeout(b)}});return()=>{o=!1,clearTimeout(b),w()}},[f,s]),i.useEffect(()=>{if(e||n)return;const b=setTimeout(async()=>{try{const w=new Promise((c,a)=>{setTimeout(()=>a(new Error("Timeout ao verificar redirecionamento")),5e3)}),A=Y(U),t=await Promise.race([A,w]);t&&t.user?console.log("✅ Login com redirecionamento bem-sucedido:",t.user.displayName):console.log("ℹ️ Nenhum resultado de redirecionamento encontrado")}catch(w){console.warn("Erro ao verificar redirecionamento:",w.message)}},200);return()=>clearTimeout(b)},[e,n]);const d=async()=>{try{console.log("🔄 Iniciando login com redirecionamento..."),await X(U,ae),console.log("✅ Redirecionamento iniciado com sucesso")}catch(o){throw console.error("❌ Erro ao iniciar login:",o),o}},g=async()=>{try{await Z(U),r(null),console.log("✅ Logout realizado")}catch(o){throw console.error("❌ Erro no logout:",o),o}};return{user:e,loading:n,login:d,logout:g,forceLogout:g,debugAuthState:()=>console.log("🧠 Auth State:",e)}}function Le(){const[e,r]=i.useState(!1),[n,u]=i.useState(!1);return i.useEffect(()=>{const f=()=>{const h=navigator.userAgent.toLowerCase(),s=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(h),d=/ipad|android(?=.*\b(?!.*mobile))/i.test(h),g=window.innerWidth,o=g<=768,b=g>768&&g<=1024;r(s||o),u(d||b)};return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),{isMobile:e,isTablet:n}}const Re=()=>{const[e,r]=i.useState({isOnline:navigator.onLine,isInstalled:!1,isInstallable:!1,isStandalone:window.matchMedia("(display-mode: standalone)").matches,hasServiceWorker:"serviceWorker"in navigator,isUpdateAvailable:!1,cacheStatus:"idle",offlineActions:0,analyticsQueue:0,deviceInfo:{isMobile:!1,isIOS:!1,isAndroid:!1,isChrome:!1,isSafari:!1,isFirefox:!1,isEdge:!1,isPWA:!1}}),[n,u]=i.useState(null);i.useEffect(()=>{const t=navigator.userAgent.toLowerCase(),c=window.matchMedia("(display-mode: standalone)").matches,a={isMobile:/mobile|android|iphone|ipad|phone/i.test(t),isIOS:/iphone|ipad|ipod/i.test(t),isAndroid:/android/i.test(t),isChrome:/chrome/i.test(t)&&!/edge/i.test(t),isSafari:/safari/i.test(t)&&!/chrome/i.test(t),isFirefox:/firefox/i.test(t),isEdge:/edge/i.test(t),isPWA:c};r(m=>({...m,deviceInfo:a,isStandalone:c}))},[]),i.useEffect(()=>{const t=()=>r(a=>({...a,isOnline:!0})),c=()=>r(a=>({...a,isOnline:!1}));return window.addEventListener("online",t),window.addEventListener("offline",c),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",c)}},[]),i.useEffect(()=>{const t=c=>{c.preventDefault(),u(c),r(a=>({...a,isInstallable:!0})),w("pwa_install_prompt_available",{timestamp:Date.now(),userAgent:navigator.userAgent})};return window.addEventListener("beforeinstallprompt",t),()=>{window.removeEventListener("beforeinstallprompt",t)}},[]),i.useEffect(()=>{const t=()=>{r(c=>({...c,isInstalled:!0,isInstallable:!1})),u(null),w("pwa_installed",{timestamp:Date.now(),userAgent:navigator.userAgent})};return window.addEventListener("appinstalled",t),()=>{window.removeEventListener("appinstalled",t)}},[]),i.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.addEventListener("updatefound",()=>{const c=t.installing;c&&c.addEventListener("statechange",()=>{c.state==="installed"&&navigator.serviceWorker.controller&&(r(a=>({...a,isUpdateAvailable:!0})),w("pwa_update_available",{timestamp:Date.now()}))})}),A()}).catch(t=>{console.error("Erro ao verificar Service Worker:",t)})},[]),i.useEffect(()=>{const t=async()=>{try{const a=await fe(),m=await ge();r(l=>({...l,offlineActions:Array.isArray(a)?a.length:0,analyticsQueue:Array.isArray(m)?m.length:0}))}catch(a){console.error("Erro ao verificar dados offline:",a)}};t();const c=setInterval(t,3e4);return()=>clearInterval(c)},[]);const f=i.useCallback(async()=>{if(!n)return!1;try{await n.prompt();const{outcome:t}=await n.userChoice;if(t==="accepted")return r(c=>({...c,isInstalled:!0,isInstallable:!1})),w("pwa_install_accepted",{timestamp:Date.now()}),!0;w("pwa_install_dismissed",{timestamp:Date.now()})}catch(t){console.error("Erro ao instalar PWA:",t),w("pwa_install_error",{error:t instanceof Error?t.message:"Unknown error",timestamp:Date.now()})}return!1},[n]),h=i.useCallback(async()=>{r(t=>({...t,cacheStatus:"caching"}));try{const t=["/images/bg_main.png","/logos/logo_circulo.png","/images/bg_1.png","/manifest.json","/offline.html","/favicon.ico","/favicon-192x192.png","/favicon-512x512.png"];await(await caches.open("interbox-critical-v2")).addAll(t),r(a=>({...a,cacheStatus:"cached"})),w("cache_critical_success",{resources:t.length,timestamp:Date.now()})}catch(t){console.error("Erro ao cachear dados críticos:",t),r(c=>({...c,cacheStatus:"error"})),w("cache_critical_error",{error:t instanceof Error?t.message:"Unknown error",timestamp:Date.now()})}},[]),s=i.useCallback(async()=>{try{const t=await caches.keys();await Promise.all(t.map(c=>caches.delete(c))),r(c=>({...c,cacheStatus:"idle"})),w("cache_cleared",{timestamp:Date.now()})}catch(t){console.error("Erro ao limpar cache:",t)}},[]),d=i.useCallback(async()=>{if("serviceWorker"in navigator)try{const t=await navigator.serviceWorker.ready;"sync"in t&&await t.sync.register("background-sync"),w("background_sync_triggered",{timestamp:Date.now()})}catch(t){console.error("Erro ao registrar background sync:",t)}},[]),g=i.useCallback(async()=>{if("serviceWorker"in navigator)try{const t=await navigator.serviceWorker.ready;"sync"in t&&await t.sync.register("analytics-sync"),w("analytics_sync_triggered",{timestamp:Date.now()})}catch(t){console.error("Erro ao registrar analytics sync:",t)}},[]),o=i.useCallback(async()=>{if(!("Notification"in window))return console.warn("Este navegador não suporta notificações"),!1;try{const t=await Notification.requestPermission();return w("notification_permission_requested",{permission:t,timestamp:Date.now()}),t==="granted"}catch(t){return console.error("Erro ao solicitar permissão de notificação:",t),!1}},[]),b=i.useCallback(async(t,c)=>{if(!("Notification"in window)||Notification.permission!=="granted")return!1;try{return new Notification(t,{icon:"/favicon-192x192.png",badge:"/favicon-96x96.png",...c}),w("notification_sent",{title:t,timestamp:Date.now()}),!0}catch(a){return console.error("Erro ao enviar notificação:",a),!1}},[]),w=i.useCallback((t,c={})=>{try{navigator.onLine?pe({event:t,timestamp:Date.now(),userAgent:navigator.userAgent,...c}):Q({event:t,timestamp:Date.now(),userAgent:navigator.userAgent,...c})}catch(a){console.error("Erro ao rastrear evento:",a)}},[]),A=i.useCallback(async()=>{try{const c=await(await caches.open("interbox-critical-v2")).keys();r(a=>({...a,cacheStatus:c.length>0?"cached":"idle"}))}catch(t){console.error("Erro ao verificar status do cache:",t),r(c=>({...c,cacheStatus:"error"}))}},[]);return{...e,installApp:f,cacheCriticalData:h,clearCache:s,syncInBackground:d,syncAnalytics:g,requestNotificationPermission:o,sendNotification:b,trackEvent:w}};async function q(){return new Promise((e,r)=>{const n=indexedDB.open("InterboxOfflineDB",1);n.onerror=()=>r(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=u=>{const f=u.target.result;f.objectStoreNames.contains("offlineActions")||f.createObjectStore("offlineActions",{keyPath:"id",autoIncrement:!0}),f.objectStoreNames.contains("offlineAnalytics")||f.createObjectStore("offlineAnalytics",{keyPath:"id",autoIncrement:!0})}})}async function ue(e,r){return(await q()).transaction([e],"readwrite").objectStore(e).add(r)}async function fe(){try{const n=(await q()).transaction(["offlineActions"],"readonly").objectStore("offlineActions");return await new Promise((f,h)=>{const s=n.getAll();s.onsuccess=()=>f(s.result),s.onerror=()=>h(s.error)})||[]}catch(e){return console.error("Erro ao buscar ações offline:",e),[]}}async function ge(){try{const n=(await q()).transaction(["offlineAnalytics"],"readonly").objectStore("offlineAnalytics");return await new Promise((f,h)=>{const s=n.getAll();s.onsuccess=()=>f(s.result),s.onerror=()=>h(s.error)})||[]}catch(e){return console.error("Erro ao buscar analytics offline:",e),[]}}async function Q(e){try{await ue("offlineAnalytics",e)}catch(r){console.error("Erro ao salvar analytics offline:",r)}}async function pe(e){try{const r=await fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error(`HTTP ${r.status}`)}catch(r){console.error("Erro ao enviar evento de analytics:",r),await Q(e)}}const me=()=>{const e=F();return(n,u)=>{i.startTransition(()=>{e(n,u)})}},De=()=>{const{user:e,loading:r}=H(),n=me(),u=G(),[f,h]=i.useState(!1);i.useEffect(()=>{const s=async()=>{if(f){console.log("🔄 useRoleRedirect: Redirecionamento já em andamento, ignorando...");return}if(console.log("🔄 useRoleRedirect: Iniciando verificação...",{hasUser:!!e,loading:r,userEmail:e==null?void 0:e.email,userRole:e==null?void 0:e.role,currentPath:u.pathname}),!e||r){console.log("🔄 useRoleRedirect: Aguardando usuário ou loading...",{hasUser:!!e,loading:r});return}if(h(!0),u.pathname==="/login"){console.log("🔄 useRoleRedirect: Na página de login com usuário logado, redirecionando para /home"),h(!0),n("/home",{replace:!0});return}console.log("🎯 useRoleRedirect: Verificando perfil do usuário...",{uid:e.uid,email:e.email,role:e.role,profileComplete:e.profileComplete});try{console.log("🔍 useRoleRedirect: Buscando dados no Firestore...",{uid:e.uid});const d=I(E,"users",e.uid),g=await N(d),o=g.data();if(console.log("📊 useRoleRedirect: Dados do usuário:",{exists:g.exists(),profileComplete:o==null?void 0:o.profileComplete,categoria:o==null?void 0:o.categoria,role:o==null?void 0:o.role,isActive:o==null?void 0:o.isActive,displayName:o==null?void 0:o.displayName}),console.log("🎯 useRoleRedirect: Decidindo redirecionamento...",{profileComplete:o==null?void 0:o.profileComplete,categoria:o==null?void 0:o.categoria,currentPath:u.pathname}),!g.exists()){console.log("🆕 useRoleRedirect: Usuário não existe no Firestore, redirecionando para seleção"),n("/selecao-cadastro",{replace:!0});return}if(!(o!=null&&o.profileComplete)){if(!(o!=null&&o.categoria)||(o==null?void 0:o.categoria)==="publico"){console.log("🎯 useRoleRedirect: Redirecionando para seleção de categoria"),n("/selecao-cadastro",{replace:!0});return}switch(console.log("🎯 useRoleRedirect: Redirecionando para cadastro específico:",o==null?void 0:o.categoria),o==null?void 0:o.categoria){case"atleta":n("/cadastro-atleta",{replace:!0});return;case"jurado":case"judge":n("/cadastro-jurado",{replace:!0});return;case"midia":n("/cadastro-midialouca",{replace:!0});return;case"espectador":n("/cadastro-curioso",{replace:!0});return;default:console.log("⚠️ useRoleRedirect: Categoria desconhecida, indo para setup-profile"),n("/setup-profile",{replace:!0});return}}console.log("✅ useRoleRedirect: Perfil completo, verificando se precisa redirecionar");const b=["/home","/hub","/perfil","/audiovisual","/audiovisual/form","/sobre","/leaderboard","/links","/admin","/dev","/marketing","/admin-painel","/dashboard-evento","/termos"];if(u.pathname==="/"){console.log("🔄 useRoleRedirect: Na raiz, redirecionando para /home"),n("/home",{replace:!0});return}b.includes(u.pathname)?console.log("✅ useRoleRedirect: Página válida, mantendo na página atual"):(console.log("🔄 useRoleRedirect: Página inválida, redirecionando para /home"),n("/home",{replace:!0}))}catch(d){console.error("❌ useRoleRedirect: Erro ao verificar perfil:",d),n("/hub",{replace:!0})}};r||(console.log("🚀 useRoleRedirect: Executando verificação...",{loading:r,currentPath:u.pathname,hasUser:!!e}),s())},[e,r,u.pathname])},j="G-56WEKYTCJZ";function ke(){if(typeof window>"u")return;const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${j}`,document.head.appendChild(e),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",j,{page_title:document.title,page_location:window.location.href,cookie_domain:"cerradointerbox.com.br",cookie_flags:"SameSite=None;Secure"})}function ye(e){typeof window<"u"&&window.gtag&&window.gtag("config",j,{page_title:e,page_location:window.location.href})}function T(e,r,n,u){typeof window<"u"&&window.gtag&&window.gtag("event",e,{event_category:r,event_label:n,value:u})}function he(e){T("click","cta",e,void 0)}function we(e){T("form_submit","form",e,void 0)}function ve(e,r){T(e,"audiovisual",r,void 0)}function be(e,r){T(e,"admin",r,void 0)}function _e(){i.useEffect(()=>{ke()},[]);const e=i.useCallback(d=>{console.log("Page tracked:",d),ye(d)},[]),r=i.useCallback((d,g)=>{console.log("Scroll tracked:",d,g),T("scroll","engagement",d,g)},[]),n=i.useCallback((d,g,o,b)=>{console.log("Event tracked:",d,g,o,b),T(d,g,o,b)},[]),u=i.useCallback((d,g)=>{console.log("CTA tracked:",d,g),he(d)},[]),f=i.useCallback(d=>{console.log("Form submit tracked:",d),we(d)},[]),h=i.useCallback((d,g)=>{console.log("Audiovisual tracked:",d,g),ve(d,g)},[]),s=i.useCallback((d,g)=>{console.log("Admin tracked:",d,g),be(d,g)},[]);return{trackPage:e,trackScroll:r,trackEvent:n,trackCTA:u,trackFormSubmit:f,trackAudiovisual:h,trackAdmin:s}}function xe(){const[e,r]=i.useState([]),[n,u]=i.useState(!0),[f,h]=i.useState(null);return i.useEffect(()=>{let s;return s=M(U,async d=>{if(d){u(!0);try{const g=_(L(E,"gamification_leaderboard"),V("points","desc"),ee(50)),b=(await P(g)).docs.map(w=>({id:w.id,...w.data()}));r(b),h(null)}catch(g){console.error("Erro ao carregar leaderboard:",g),h(g.message)}u(!1)}else r([]),u(!1),h("Usuário não autenticado")}),()=>{s&&s()}},[]),{leaderboard:e,loading:n,error:f}}const Be=()=>{const{user:e}=H(),[r,n]=i.useState([]),[u,f]=i.useState(!1),[h,s]=i.useState(null),[d,g]=i.useState(null),o=i.useCallback(async()=>{if(e){f(!0),s(null);try{const m=_(L(E,"shortLinks"),D("createdBy","==",e.uid),V("createdAt","desc"));return te(m,p=>{const k=[];p.forEach(y=>{var x,v,B;const C=y.data();k.push({id:y.id,...C,createdAt:((x=C.createdAt)==null?void 0:x.toDate())||new Date,updatedAt:((v=C.updatedAt)==null?void 0:v.toDate())||new Date,expiresAt:(B=C.expiresAt)==null?void 0:B.toDate(),analytics:C.analytics||{totalClicks:0,clicksByDate:{},clicksByHour:{},clicksByDevice:{},clicksByCountry:{}}})}),n(k)})}catch(m){s("Erro ao carregar links"),console.error("Erro ao buscar links:",m)}finally{f(!1)}}},[e]),b=i.useCallback(async m=>{if(!e)return s("Usuário não autenticado"),null;f(!0),s(null);try{const l=re(m);if(!l.isValid)return s(l.errors.join(", ")),null;const p=ie(m);let k=p.customCode||$();if(!p.customCode){let v=0;for(;v<10&&!(await P(_(L(E,"shortLinks"),D("shortCode","==",k)))).empty;)k=$(),v++}const y={originalUrl:p.originalUrl,shortCode:k,shortUrl:ne(k),title:p.title,description:p.description,tags:p.tags,category:p.category,isActive:!0,isPublic:p.isPublic??!0,clickCount:0,uniqueVisitors:0,createdAt:new Date,updatedAt:new Date,expiresAt:p.expiresAt,createdBy:e.uid,analytics:{totalClicks:0,clicksByDate:{},clicksByHour:{},clicksByDevice:{},clicksByCountry:{}}};return{id:(await z(L(E,"shortLinks"),{...y,createdAt:S(),updatedAt:S()})).id,...y}}catch(l){return s("Erro ao criar link"),console.error("Erro ao criar link:",l),null}finally{f(!1)}},[e]),w=i.useCallback(async(m,l)=>{if(!e)return s("Usuário não autenticado"),!1;f(!0),s(null);try{const p=I(E,"shortLinks",m),k=await N(p);return k.exists()?k.data().createdBy!==e.uid?(s("Sem permissão para editar este link"),!1):(await O(p,{...l,updatedAt:S()}),!0):(s("Link não encontrado"),!1)}catch(p){return s("Erro ao atualizar link"),console.error("Erro ao atualizar link:",p),!1}finally{f(!1)}},[e]),A=i.useCallback(async m=>{if(!e)return s("Usuário não autenticado"),!1;f(!0),s(null);try{const l=I(E,"shortLinks",m),p=await N(l);return p.exists()?p.data().createdBy!==e.uid?(s("Sem permissão para deletar este link"),!1):(await oe(l),!0):(s("Link não encontrado"),!1)}catch(l){return s("Erro ao deletar link"),console.error("Erro ao deletar link:",l),!1}finally{f(!1)}},[e]),t=i.useCallback(async m=>{try{const l=I(E,"shortLinks",m),p=navigator.userAgent,k=document.referrer,y=se(p),C={shortLinkId:m,clickedAt:new Date,userAgent:p,referrer:k,device:y,userId:e==null?void 0:e.uid,sessionId:sessionStorage.getItem("sessionId")||crypto.randomUUID()};await z(L(E,"shortLinkClicks"),{...C,clickedAt:S()}),await O(l,{clickCount:R(1),"analytics.totalClicks":R(1),[`analytics.clicksByDate.${new Date().toISOString().split("T")[0]}`]:R(1),[`analytics.clicksByHour.${new Date().getHours().toString().padStart(2,"0")}`]:R(1),[`analytics.clicksByDevice.${y}`]:R(1),"analytics.lastClickedAt":S()})}catch(l){console.error("Erro ao registrar clique:",l)}},[e]),c=i.useCallback(async m=>{var l,p,k;try{const y=_(L(E,"shortLinks"),D("shortCode","==",m),D("isActive","==",!0)),C=await P(y);if(C.empty)return null;const x=C.docs[0],v=x.data(),B={id:x.id,originalUrl:v.originalUrl,shortCode:v.shortCode,shortUrl:v.shortUrl,title:v.title,description:v.description,tags:v.tags,category:v.category,isActive:v.isActive,isPublic:v.isPublic,clickCount:v.clickCount||0,uniqueVisitors:v.uniqueVisitors||0,createdAt:((l=v.createdAt)==null?void 0:l.toDate())||new Date,updatedAt:((p=v.updatedAt)==null?void 0:p.toDate())||new Date,expiresAt:(k=v.expiresAt)==null?void 0:k.toDate(),createdBy:v.createdBy,metadata:v.metadata,analytics:v.analytics||{totalClicks:0,clicksByDate:{},clicksByHour:{},clicksByDevice:{},clicksByCountry:{}}};return ce(B)?null:B}catch(y){return console.error("Erro ao buscar link:",y),null}},[]),a=i.useCallback(async()=>{if(e)try{const m=await P(_(L(E,"shortLinks"),D("createdBy","==",e.uid))),l={totalLinks:m.size,totalClicks:0,activeLinks:0,expiredLinks:0,topLinks:[],clicksByCategory:{},clicksByDate:{}},p=[];m.forEach(k=>{const y=k.data(),C=y.clickCount||0;l.totalClicks+=C,le(y)?l.activeLinks++:l.expiredLinks++,y.category&&(l.clicksByCategory[y.category]=(l.clicksByCategory[y.category]||0)+C),p.push({id:k.id,title:y.title||"Sem título",clicks:C,shortUrl:y.shortUrl})}),l.topLinks=p.sort((k,y)=>y.clicks-k.clicks).slice(0,5),g(l)}catch(m){console.error("Erro ao buscar estatísticas:",m)}},[e]);return i.useEffect(()=>{e&&(o(),a())},[e,o,a]),{links:r,loading:u,error:h,stats:d,createLink:b,updateLink:w,deleteLink:A,registerClick:t,getLinkByCode:c,fetchUserLinks:o,fetchStats:a}};export{H as a,xe as b,Be as c,Re as d,Le as e,De as f,me as g,_e as u};
